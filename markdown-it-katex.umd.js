!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("katex")):"function"==typeof define&&define.amd?define(["katex"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).markdownItKatex=t(e.katex)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e);const n=(e,t)=>{let r,n,i=!0,l=!0;const o=e.posMax;return r=t>0?e.src.charCodeAt(t-1):-1,n=t+1<=o?e.src.charCodeAt(t+1):-1,(32===r||9===r||n>=48&&n<=57)&&(l=!1),32!==n&&9!==n||(i=!1),{can_open:i,can_close:l}};const i={inlineDelimeter:"$",inlineRuleName:"math_inline",blockDelimeter:"$$",blockRuleName:"math_block"};return function(e,t={}){const l={...i,...t};if(1!==l.inlineDelimeter.length)throw Error("inline delimeter must be single character!");const o=(t,r)=>(console.error(t),e.utils.escapeHtml(r));e.inline.ruler.after("escape","math_inline",(e=>{const{inlineDelimeter:t,inlineRuleName:r}=e;return(e,i)=>{if(e.src[e.pos]!==t)return!1;if(!n(e,e.pos).can_open)return i||(e.pending+=t),e.pos+=1,!0;let l,o,c,s;for(l=e.pos+1,o=l;-1!==(o=e.src.indexOf(t,o));){for(s=o-1;"\\"===e.src[s];)s-=1;if((o-s)%2==1)break;o+=1}return-1===o?(i||(e.pending+=t),e.pos=l,!0):o-l==0?(i||(e.pending+=`${t}${t}`),e.pos=l+1,!0):n(e,o).can_close?(i||(c=e.push(r,"math",0),c.markup=t,c.content=e.src.slice(l,o)),e.pos=o+1,!0):(i||(e.pending+=t),e.pos=l,!0)}})(l)),e.block.ruler.after("blockquote","math_block",(e=>{const{blockDelimeter:t,blockRuleName:r}=e,n=t.length;return(e,i,l,o)=>{let c,s,a,u,f,p=!1,d=e.bMarks[i]+e.tShift[i],m=e.eMarks[i];if(d+n>m)return!1;if(e.src.slice(d,d+n)!==t)return!1;if(d+=n,c=e.src.slice(d,m),o)return!0;for(c.trim().slice(-n)===t&&(c=c.trim().slice(0,-n),p=!0),a=i;!(p||(a++,a>=l)||(d=e.bMarks[a]+e.tShift[a],m=e.eMarks[a],d<m&&e.tShift[a]<e.blkIndent));)e.src.slice(d,m).trim().slice(-n)===t&&(u=e.src.slice(0,m).lastIndexOf(t),s=e.src.slice(d,u),p=!0);return e.line=a+1,f=e.push(r,"math",0),f.block=!0,f.content=(c&&c.trim()?c+"\n":"")+e.getLines(i+1,a,e.tShift[i],!0)+(s&&s.trim()?s:""),f.map=[i,e.line],f.markup=t,!0}})(l),{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.math_inline=((e,t)=>{const n={...e,displayMode:!1};return(e,i,l,o,c)=>{const s=e[i].content;try{return r.default.renderToString(s,n)}catch(e){return t(e,s)}}})(l,o),e.renderer.rules.math_block=((e,t)=>{const n={...e,displayMode:!0};return(e,i,l,o,c)=>{const s=e[i].content+"\n";try{return`<p>${r.default.renderToString(s,n)}</p>`}catch(e){return t(e,s)}}})(l,o)}}));
